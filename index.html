<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JustStock Signup</title>
  </head>
  <body>
    <div id="root"></div>
    <script>
      // Normalize common referral URL patterns to query `?ref=<CODE>`
      // Supported:
      // - /d/<code>, /ref/<code>, /invite/<code>
      // - /<code>  (single segment at root)
      (function () {
        try {
          var pathname = location.pathname || '';
          var params = new URLSearchParams(location.search || '');

          // Already present? Nothing to do.
          if (params.get('ref') || params.get('r') || params.get('referral') || params.get('referralCode')) return;

          var code = null;

          // Pattern 1: /d/<code> or /ref/<code> or /invite/<code>
          var m1 = pathname.match(/\/(d|ref|invite)\/([A-Za-z0-9_-]+)/i);
          if (m1 && m1[2]) code = m1[2];

          // Pattern 2: single root segment that looks like a code => /<code>
          if (!code) {
            var trimmed = pathname.replace(/^\/+|\/+$/g, '');
            var reserved = { assets: true };
            if (trimmed && !trimmed.includes('/') && /^[A-Za-z0-9_-]{4,}$/i.test(trimmed) && !reserved[trimmed.toLowerCase()]) {
              code = trimmed;
            }
          }

          if (code) {
            params.set('ref', code);
            var base = location.origin + '/';
            var newUrl = base + '?' + params.toString();
            history.replaceState(null, '', newUrl);
          }
        } catch (e) {}
      })();
    </script>
    <script type="module" src="/src/main.jsx"></script>
  </body>
  </html>
